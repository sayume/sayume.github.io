<!DOCTYPE html>
<html>
<body>
<h3>Deploy mysql environment with docker</h3>
<p>Whenever move work space from one machine to another, it's annoying to move the database environment. If two machines
   can remote access the same database, it's OK. If it is not, we have to deploy and config the same database twice.
   However, with docker we can easily solve this problem. One docker, one space, and work everywhere.</p>
<p>First we have to install docker, for docker installation information, please refer to docker official site.</p>
<p>Then with docker installed, we need to choose a database image,like mysql. There are many docker images in github,
I searched github and consult on stackoverflow, and chose tutum/mysql, I installed tutum/mysql, it works, however
    if I add more than one options to docker command, it fails and the password environment param sometimes
doesn't work, I searched on web but got no result for this problem. Finally I chose the official image of mysql from docker
official site.</p>
<p>From the official site, I use the the following command to start a mysql container:</p>
<pre>
    docker run --name test-mysql -e MYSQL_ROOT_PASSWORD=root -d -v /home/master/db/mysql:/var/lib/mysql mysql
</pre>
<p>In the previous command, we start a docker container named "test-mysql" and hold a mysql database with password "root"
for root account. It's very important to have "-v" option, it has a local folder mapped to "/var/lib/mysql",
 which is the default location of db files, that means if we shut down the container, the data in the database will
still be persisted, and we can even reinstall another mysql container based on the data. The last word "mysql" is
the image name, for the first time you use this image, docker will download it from remote server, the process is very
slow, and it took me couple of hours!</p>
<p>After installation of the image, we can use this command to connect to the mysql server:</p>
<pre>
    docker run -it --link test-mysql:mysql --rm mysql sh -c 'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"'
</pre>
<p>You can see the familiar mysql input indicator.Thanks god, we can finally link to this mysql server! However it's not
 over yet, if we can not connect it with other applications it is useless. Fortunately, we can use this command to see
what's going on with this image:</p>
<pre>
    docker inspect test-mysql
</pre>
And the output looks like this:
<div style="margin:10px;"><image style="width:500px;" src="../images/Selection_003.png"/></div>
<p>We find the ip of this mysql server is "172.17.0.2". Good, we can connect it with remote account.We go back to mysql
 console and type in the following sentence:</p>
<pre>
    grant all privileges on *.* to 'admin'@'%' identified by 'admin';
    flush privileges;
</pre>
<p>Then open the mysql work bench, Great! we connect to the test-mysql database, like we do it with any other mysql server.</p>
<div style="margin:10px;"><image style="width:500px;" src="../images/Selection_004.png"/></div>
<p>For details about docker command and mysql image, please refer to the official site.</p>
</body>
</html>